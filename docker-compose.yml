db:
  image: dockerfile/mongodb
  command: mongod --rest --httpinterface
  expose:
    - "27017"
  ports:
    - "28017:28017"
    - "27017:27017"
redis:
  image: redis:latest
  ports:
    - "15672:15672"
# api:
#   build: .
#   command: python flask/api/api.py
#   volumes:
#     - .:/code
#     - logs/:/var/log
#   ports:
#     - "8081:8081"
#   links:
#     - db
#     - db:database
#     - redis
#   environment:
#     - VIRTUAL_HOST=api.localhost
# flask:
#   build: .
#   command: python flask/manage.py runserver
#   volumes:
#     - .:/code
#     - logs/:/var/log
#   ports:
#     - "5000:5000"
#   links:
#     - db
#     - db:database
#     - redis
#   environment:
#     - VIRTUAL_HOST=flask.localhost
# nginx:
#   image: jwilder/nginx-proxy
#   volumes:
#     - /var/run/docker.sock:/tmp/docker.sock
#   ports:
#     - "80:80"
workers:
  build: .
  # image: dockerfile/supervisor
  volumes:
    - conf/supervisor:/etc/supervisor/conf.d
    - .:/code
  ports:
    - "8080:8080"
    - "8081:8081"
  links:
    - db
    - db:database
    - redis